#
# $Id$
# $Source$
#
# Tested the following firmware versions:
#    Revision F 5.00, (C) 2001
#    Revision F 5.01, (C) 2001
# Assumes:
# 1. command confirmation : disabled (3/configuration, 6/outlets, 2/...)
# 2. admin account password : "baytech" (2/manage users, 2/admin, 1/...)
# 3. net: prompt for password : enabled (3/configuration, 5/access, 2/...)
# Note: prompt is not returned until device is ready to accept another commmand
#
begin protocol specification
	specification name "baytech"
	specification type "TCP"
	off string "Off"
	on string  "On"
	all string "0"
	plug count 8
	device timeout 20  # "reboot all" command takes about 13 seconds 
	ping period 90
	begin PING_SCRIPT
		send "\r\n"
		expect "RPC-3>"
	end PING_SCRIPT
	begin LOGIN_SCRIPT
		expect "\n"
		send "\IAC\DO\TELOPT_ECHO\IAC\DO\TELOPT_SGA"
		expect "Enter password>"
		send "baytech\r\n"
		expect "Enter Selection>"
		send "1\r\n"
		expect "RPC-3>"
	end LOGIN_SCRIPT
	begin LOGOUT_SCRIPT
		send "menu\r\n"
		expect "Enter Selection>"
		send "6\r\n"
	end LOGOUT_SCRIPT
	begin STATUS_SCRIPT
		send "status\r\n"
		expect "Circuit Breaker:[^\n]*\r\n"
		expect "[^\n]*(On|Off)[^\n]*\r\n"
			map $1 "1"
		expect "[^\n]*(On|Off)[^\n]*\r\n"
			map $1 "2"
		expect "[^\n]*(On|Off)[^\n]*\r\n"
			map $1 "3"
		expect "[^\n]*(On|Off)[^\n]*\r\n"
			map $1 "4"
		expect "[^\n]*(On|Off)[^\n]*\r\n"
			map $1 "5"
		expect "[^\n]*(On|Off)[^\n]*\r\n"
			map $1 "6"
		expect "[^\n]*(On|Off)[^\n]*\r\n"
			map $1 "7"
		expect "[^\n]*(On|Off)[^\n]*\r\n"
			map $1 "8"
		expect "RPC-3>"
	end STATUS_SCRIPT
	begin ON_SCRIPT
		send "on %s\r\n"
		expect "RPC-3>"
	end ON_SCRIPT
	begin OFF_SCRIPT
		send "off %s\r\n"
		expect "RPC-3>"
	end OFF_SCRIPT
# If outlet is initially off, "reboot" will leave it off.
# This doesn't match PowerMan's semantics for cycle.
	begin CYCLE_SCRIPT
		send "off %s\r\n"
		expect "RPC-3>"
		sleep 2
		send "on %s\r\n"
		expect "RPC-3>"
	end CYCLE_SCRIPT
	plug name "1"
	plug name "2"
	plug name "3"
	plug name "4"
	plug name "5"
	plug name "6"
	plug name "7"
	plug name "8"
end protocol specification
