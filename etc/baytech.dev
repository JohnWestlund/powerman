#
# $Id$
# $Source$
#
# Tested the following firmware versions:
#    Revision F 5.00, (C) 2001
#    Revision F 5.01, (C) 2001
# Assumes:
# 1. command confirmation : disabled (3/configuration, 6/outlets, 2/...)
# 2. admin account password : "baytech" (2/manage users, 2/admin, 1/...)
# 3. net: prompt for password : enabled (3/configuration, 5/access, 2/...)
# Note: prompt is not returned until device is ready to accept another commmand
#
specification {
	name 		"baytech"
	type 		"telnet"
	offstring 	"Off"
	onstring  	"On"
	maxplugcount 	8
	timeout 	10   # about 5 sec for cycle command
	pingperiod 	90

	script ping {
		send "\r\n"
		expect "RPC-3>"
	}
	script login {
		expect "\n"
		expect "Enter password>"
		send "baytech\r\n"
		expect "Enter Selection>"
		send "1\r\n"
		expect "RPC-3>"
	}
	script logout {
		send "menu\r\n"
		expect "Enter Selection>"
		send "6\r\n"
	}
	script status_all {
		send "status\r\n"
		expect "Circuit Breaker:[^\n]*\r\n"
		expect "[^\n]*(On|Off)[^\n]*\r\n"
		setstatus "1" $1
		expect "[^\n]*(On|Off)[^\n]*\r\n"
		setstatus "2" $1
		expect "[^\n]*(On|Off)[^\n]*\r\n"
		setstatus "3" $1
		expect "[^\n]*(On|Off)[^\n]*\r\n"
		setstatus "4" $1
		expect "[^\n]*(On|Off)[^\n]*\r\n"
		setstatus "5" $1
		expect "[^\n]*(On|Off)[^\n]*\r\n"
		setstatus "6" $1
		expect "[^\n]*(On|Off)[^\n]*\r\n"
		setstatus "7" $1
		expect "[^\n]*(On|Off)[^\n]*\r\n"
		setstatus "8" $1
		expect "RPC-3>"
	}
	script on {
		send "on %s\r\n"
		expect "RPC-3>"
	}
	script on_all {
		send "on 0\r\n"
		expect "RPC-3>"
	}
	script off {
		send "off %s\r\n"
		expect "RPC-3>"
	}
	script off_all {
		send "off 0\r\n"
		expect "RPC-3>"
	}
# If outlet is initially off, "reboot" will leave it off.
# This doesn't match PowerMan's semantics for cycle, so explicitly power
# off then on.
	script cycle {
		send "off %s\r\n"
		expect "RPC-3>"
		delay 2
		send "on %s\r\n"
		expect "RPC-3>"
	}
	script cycle_all {
		send "off 0\r\n"
		expect "RPC-3>"
		delay 2
		send "on 0\r\n"
		expect "RPC-3>"
	}
	plug name "1"
	plug name "2"
	plug name "3"
	plug name "4"
	plug name "5"
	plug name "6"
	plug name "7"
	plug name "8"
}
