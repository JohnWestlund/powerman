#
# wti-rps10.dev,v 1.6 2003/01/17 23:50:34 garlick Exp
# /chaos/cvs/powerman/etc/wti-rps10.dev,v
#
# Master configured for 9600 baud:
# if 9600 - wait 0.5 sec before sending next command
# if 2400 - wait 1.5 sec before sending next command
# Format of commands is ^X^X^B^X^X^B^X^XPC\r
#   where P is port number (0-9) and C is command (0,1,T,?)
#
# Note: I seem to get good responses from the master node but the slaves
# tend to intersperse garbage in the reply, e.g. "Complete" doesn't usually
# make it.
#   
specification  {
	name 		"wti-rps10"
	type 		"serial"
	offstring 	"Off"
	onstring  	"On"
	plugcount	10
	timeout 	13  # toggle can be configured for 10 sec

	script login {
#		expect "RPS-10 Ready\n\n"
		send ""
	}
	script logout {
		send "\r"
	}
# Do not define STATUS_ALL_SCRIPT because there may not be all 10
# boxes in a chain, and any missing ones will not respond, causing
# expect to time out
	script status {
		send "\030\030\002\030\030\002\030\030%s?\r"
		expect "Plug [0-9] (On|Off)"
			map $1 "%s"
#		expect "Complete"
		delay 0.5
	}
	script on {
		send "\030\030\002\030\030\002\030\030%s1\r"
		expect "Plug [0-9] On"
#		expect "Complete"
		delay 0.5
	}
	script off {
		send "\030\030\002\030\030\002\030\030%s0\r"
		expect "Plug [0-9] Off"
#		expect "Complete"
		delay 0.5
	}
	script cycle {
		send "\030\030\002\030\030\002\030\030%sT\r"
		expect "Plug [0-9] Off"
		expect "Plug [0-9] On"
#		expect "Complete"
		delay 0.5
	}
	plug name "0"
	plug name "1"
	plug name "2"
	plug name "3"
	plug name "4"
	plug name "5"
	plug name "6"
	plug name "7"
	plug name "8"
	plug name "9"
}
