#
# Sun ILOM 
#
specification  "ilom" {
	timeout 	60

	plug name { "1" }

	script login {
		delay 1
	}
	script status {
		send "\033("
		expect "Serial console stopped."
		expect "->"
		send "show -d properties /SYS/POWERSTATE\n"
		expect "POWERSTATE = (on|off)"
		setplugstate "1" $1 on="on" off="off"
		expect "->"
		send "start -script /SP/console\n"
	}
	script on {
		send "\033("
		expect "Serial console stopped."
		expect "->"
		send "show -d properties /SYS/POWERSTATE\n"
		expect "POWERSTATE = (on|off)"
		setplugstate "1" $1 on="on" off="off"
		expect "->"
		ifoff {
			send "start -script /SYS\n"
			expect "->"
		}
		send "start -script /SP/console\n"
	}		
	script off {
		send "\033("
		expect "Serial console stopped."
		expect "->"
		send "show -d properties /SYS/POWERSTATE\n"
		expect "POWERSTATE = (on|off)"
		setplugstate "1" $1 on="on" off="off"
		expect "->"
		ifon {
			send "stop -script -force /SYS\n"
			expect "->"
		}
		send "start -script /SP/console\n"
	}		
	script cycle {
		send "\033("
		expect "Serial console stopped."
		expect "->"
		send "show -d properties /SYS/POWERSTATE\n"
		expect "POWERSTATE = (on|off)"
		setplugstate "1" $1 on="on" off="off"
		expect "->"
		ifon {
			send "stop -script -force /SYS\n"
			expect "->"
			delay 4	
		}
		send "start -script /SYS\n"
		expect "->"
		send "start -script /SP/console\n"
	}
}
