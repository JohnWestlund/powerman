#
# $Id$
# $Source$
#
# Tested the following firmware versions: 
#    v3.02
# Assumes: 
# 1. password: "wti" (/g general parms, 1 system passwd)
# 3. command confirmation: off (/g general parms, 8 command confirmation)
# 4. disconnect timeout: set to max (30 min)
# Note: prompt is not returned until device is ready to accept another command
#
specification {
	name 		"wti"
	type 		"TCP"
	offstring 	"OFF"
	onstring  	"ON"
	plugcount 	8
	timeout 	30  # "/boot *" command takes about 20 sec
	script login {
		expect "\n"
		send "\IAC\DO\TELOPT_ECHO\IAC\DO\TELOPT_SGA\IAC\DONT\TELOPT_TTYPE"
		expect "word: "
		send "wti\r\n"
		expect "NPS> "
	}
	script logout {
		send "/x\r\n"
	}
	script status_all {
		send "/s\r\n"
		expect "Default"
		expect "\\+\r\n"
		expect " 1[^\n]*(ON|OFF)[^\n]*(ON|OFF)[^\n]*\r\n"
			map $1 "1"
		expect " 2[^\n]*(ON|OFF)[^\n]*(ON|OFF)[^\n]*\r\n"
			map $1 "2"
		expect " 3[^\n]*(ON|OFF)[^\n]*(ON|OFF)[^\n]*\r\n"
			map $1 "3"
		expect " 4[^\n]*(ON|OFF)[^\n]*(ON|OFF)[^\n]*\r\n"
			map $1 "4"
		expect " 5[^\n]*(ON|OFF)[^\n]*(ON|OFF)[^\n]*\r\n"
			map $1 "5"
		expect " 6[^\n]*(ON|OFF)[^\n]*(ON|OFF)[^\n]*\r\n"
			map $1 "6"
		expect " 7[^\n]*(ON|OFF)[^\n]*(ON|OFF)[^\n]*\r\n"
			map $1 "7"
		expect " 8[^\n]*(ON|OFF)[^\n]*(ON|OFF)[^\n]*\r\n"
			map $1 "8"
		expect "\\+\r\n"
		expect "NPS> "
	}
	script on {
		send "/on %s\r\n"
		expect "NPS> "
	}
	script on_all {
		send "/on *\r\n"
		expect "NPS> "
	}
	script off {
		send "/off %s\r\n"
		expect "NPS> "
	}
	script off_all {
		send "/off *\r\n"
		expect "NPS> "
	}
	script cycle {
		send "/boot %s\r\n"
		expect "NPS> "
	}
	script cycle_all {
		send "/boot *\r\n"
		expect "NPS> "
	}
	plug name "1"
	plug name "2"
	plug name "3"
	plug name "4"
	plug name "5"
	plug name "6"
	plug name "7"
	plug name "8"
}
