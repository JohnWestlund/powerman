#
# $Id$
# $Source$
#
# This is just a start - not working yet.  In fact it seems that the
# telnet interface can't access chains of nodes on our setup
# (x335 / x345 nodes), so all you get here is access to the node
# that has the RSA card in it. Sigh.
#
specification {
	name 		"ibmasm"
	type 		"TCP"
	offstring 	"Off"
	onstring  	"On"
	plugcount 	1
	timeout  	5

	script login {
		send "\IAC\DONT\TELOPT_NAWS\IAC\DONT\TELOPTTTYPE"
		expect "Login ID:"
		send "USERID\r\n"
		send "PASSW0RD\r\n"
		expect "Select" 
	}
	script logout {
		send "\033"			# ESC to log off
	}
	script status_all {
		send "\t\t\t\t"			# tab to power/restart menu
		expect "Server Power/Restart"
		send "\r\n"			# select it
		expect "System Power Status: (On|Off)"
		map $1 "1"
		expect "Select"
		send "\033"			# ESC back to main menu
		expect "Select"  	
	}
	script on {
		send "\t\t\t\t"			# tab to power/restart menu
		expect "Server Power/Restart"
		send "\r\n"			# select it
		expect "Select"
		send "\r\n"			# select (default) power on
		expect "continue?"
		send "\r\n"			# select Yes
		expect "performing a Power on Server Immediately"
		send "\r\n"			# select Ok
		expect "System Power Status: On"
		expect "Select"
		send "\033"			# return to main menu
		expect "Select"
	}
	script off {
		send "\t\t\t\t"			# tab to power/restart menu
		expect "Server Power/Restart"
		send "\r\n"			# select it
		expect "Select"
		send "\t\t"			# tab to power off
		expect "Power off"
		send "\r\n"			# select it
		expect "continue?"
		send "\r\n"			# select Yes
		expect "performing a Power off Server Immediately"
		send "\r\n"			# select Ok
		expect "System Power Status: Off"
		expect "Select"
		send "\033"			# return to main menu
		expect "Select"
	}
	script cycle {
		send "\t\t\t\t"			# tab to power/restart menu
		expect "Server Power/Restart"
		send "\r\n"			# select it
		expect "Select"
		send "\t\t\t\t\t"		# tab to restart
		expect "Restart"
		send "\r\n"			# select it
		expect "continue?"
		send "\r\n"			# select Yes
		expect "performing a Restart Server Immediately"
		send "\r\n"			# select Ok
		expect "System Power Status: Off"
		expect "Select"
		send "\033"			# return to main menu
		expect "Select"
	}
	plug name "1"
}
