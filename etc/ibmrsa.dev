#
# $Id$
# $Source$
#
# IBM Remote Supervisor Adapter (RSA) 
#
# The RSA is an externally powered PCI adapter with its own ethernet connection
# and an RS485 interface.  The RS485 interface daisy chains up to 20 IBM 
# x-series nodes, including the node hosting the RSA adapter.  The x-series 
# nodes have a service processor, based on the H8 microprocessor and code 
# named "hawk", integrated into the mainboard.  The RSA adapter can forward 
# power on/off/status commands to the hawks via RS485.
# 
# Normally the RSA's provide a web front end.  PowerMan uses an undocumented
# debug interface available by telnetting into the RSA and typing ctrl-D.
# The 'power' command in debug mode was added in April 2003.   See f/w images:
# GEET117A.tgz (x345) and T2ET116-.tgz (x335).
#
specification {
	name 		"ibmrsa"
	type 		"telnet"
	offstring 	"off"
	onstring  	"on"
	plugcount 	24
	timeout  	20

	script login {
		expect "Login ID:"
		send "USERID\r\n"
		send "PASSW0RD\r\n"
		expect "Select" 
		delay 1
		send "\004"  			# ^D to enter "debug mode"
		expect "==> "
	}
	script logout {
		send "\004"  			# ^D to log completely off
	}
	script status {
		send "power 2 %s\r\n"
		expect "Status = (on|off)\r\n"
			map $1 "%s"
	}
	script on {
		send "power 1 %s\r\n"
		expect "Status = on\r\n"
	}
	script off {
		send "power 0 %s\r\n"
		expect "Status = off\r\n"
	}
	script cycle {
		send "power 0 %s\r\n"
		expect "Status = off\r\n"
		delay 2
		send "power 1 %s\r\n"
		expect "Status = on\r\n"
	}
# No plug names - the names will come from the 'node' entrise in powerman.conf
}
