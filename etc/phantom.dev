#
# $Id$
# $Source$
#
specification  "phantom" {
	type 		TELNET
	timeout 	20.0

	plug name { "1" }

	script login {
		send "\036\035"	# enter "shell mode"
		expect "ok\r"
	}
	script status {
		send "P?\r\n"
		expect "(0|1)\r"
		setplugstate "1" $1 on="1" off="0"
	}
	script on {
		send "P?\r\n"
		expect "(0|1)\r"
		setplugstate "1" $1 on="1" off="0"
		ifoff {
			send "PT\r\n"
			expect "ok\r"
		}
	}		
	script off {
		send "P?\r\n"
		expect "(0|1)\r"
		setplugstate "1" $1 on="1" off="0"
		ifon {
			send "PT\r\n"
			expect "ok\r"
		}
	}		
	script cycle {
		send "P?\r\n"
		expect "(0|1)\r"
		setplugstate "1" $1 on="1" off="0"
		ifon {
			send "PT\r\n"
			expect "ok\r"
		}
		delay 2
		send "PT\r\n"
		expect "ok\r"
	}
	script beacon_on {
		send "L1\r\n"	# LED on
		expect "ok\r"
		send "B1\r\n"	# blink LED
		expect "ok\r"
	}
	script beacon_off {
		send "L0\r\n"	# LED off
		expect "ok\r"
		send "B0\r\n"	# unblink LED
		expect "ok\r"
	}
	script status_beacon {
		send "L?\r\n"	# get LED status 1=on, 0=off, B=blink
		expect "(0|1|B)" 
		setplugstate "1" $1 on="(B|1)" off="0"
	}
# Ack this crashes powerman right now!
#	script status_temp {
#		send "T0\r\n"	# get temp probe 0 (there is also a 1- unused)
#		expect "([0-9]+)\r" # value is 8-bit Celcius  
#		setplugstate "1" $1
#	}
}
