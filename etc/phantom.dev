#
# $Id$
# $Source$
#
specification  "phantom" {
	type 		SERIAL
	timeout 	5 

	plug name { "1" }

	script login {
		expect "Choose a command"
		send "\035"	# enter "shell mode"
	}
	script status {
		send "P?\r\n"
		expect "(0|1)\r"
		setplugstate "1" $1 on="1" off="0"
	}
	script on {
		send "P?\r\n"
		expect "(0|1)\r"
		setplugstate "1" $1 on="1" off="0"
		ifoff {
			send "PT\r\n"
			expect "ok\r"
		}
	}		
	script off {
		send "P?\r\n"
		expect "(0|1)\r"
		setplugstate "1" $1 on="1" off="0"
		ifon {
			send "PT\r\n"
			expect "ok\r"
		}
	}		
	script cycle {
		send "P?\r\n"
		expect "(0|1)\r"
		setplugstate "1" $1 on="1" off="0"
		ifon {
			send "PT\r\n"
			expect "ok\r"
		}
		delay 2
		send "PT\r\n"
		expect "ok\r"
	}
	script beacon_on {
		send "L1\r\n"	# LED on
		expect "ok\r"
		send "B1\r\n"	# blink LED
		expect "ok\r"
	}
	script beacon_off {
		send "L0\r\n"	# LED off
		expect "ok\r"
	}
	script status_beacon {
		send "L?\r\n"	# get LED status 0=on, 1=off, B=blink
		expect "(0|1|B)" 
		setplugstate "1" $1 on="(B|0)" off="1"
	}
	script status_temp {
		send "T0\r\n"	# get temp probe 0 (there is also a 1- unused)
		expect "([0-9]+)\r" # value is 8-bit Celcius  
		setplugstate "1" $1
	}
}
